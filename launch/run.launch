<?xml version="1.0"?>

<launch>

  <!-- Master launch file for RPI ARM composites manufacturing quick start project -->

  <arg name="joy_dev" default="/dev/input/js0"/>
  <arg name="abb_irc5_uri" default="http://192.168.125.1/"/>
  <arg name="netft_host" default=""/>
  <arg name="abb_irc5_rapid_auto_stop" default="true"/>

  <arg name="sim" default="false"/>

  <param name="move_group/trajectory_execution/allowed_execution_duration_scaling" value="4.0" />
  <param name="move_group/trajectory_execution/execution_duration_monitoring" value="false" />
  <param name="move_group/trajectory_execution/controller_connection_timeout" value="120"/>
  

  <arg name="disable_moveit" default="false"/>
  <include file="$(find rpi_arm_composites_manufacturing_testbed_moveit_config)/launch/moveit_planning_execution.launch" unless="$(arg disable_moveit)">
    <arg name="start_interface" value="false"/>
    <arg name="planning_pipeline" value="ompl"/>
  </include>

  <arg name="disable_kinematic_controller" default="false"/>
  <include file="$(find rpi_arm_composites_manufacturing_abb_egm_controller)/launch/arm_composites_controller.launch" unless="$(arg disable_kinematic_controller)">
    <arg name="joy_dev" value="$(arg joy_dev)"/>
    <arg name="abb_irc5_uri" value="$(arg abb_irc5_uri)"/>
    <arg name="netft_host" value="$(arg netft_host)"/>
    <arg name="abb_irc5_rapid_auto_stop" value="$(arg abb_irc5_rapid_auto_stop)"/>
  </include>  
    
  <include file="$(find rpi_arm_composites_manufacturing_testbed)/launch/rviz_sim_cameras.launch" if="$(arg sim)"/>
  <include file="$(find rpi_arm_composites_manufacturing_testbed)/launch/rviz_sim_cameras_params.launch" if="$(arg sim)"/>
  
  <node name="overhead_image_view" pkg="image_view" type="image_view" args="image:=/overhead_camera/image"/>
 
  <include file="$(find rpi_arm_composites_manufacturing_testbed)/launch/load_payloads.launch"/>

  <!-- TODO: use a package for vision server instead of this script -->

  <group unless="$(arg sim)">
      <node name="pyspin_overhead_service" pkg="pyspin_wrapper" type="pyspin_overhead_service.py" respawn="false"/>
	  <node name="pyspin_gripper_proximal_service" pkg="pyspin_wrapper" type="pyspin_gripper_proximal_service.py" respawn="false"/>
	  <node name="pyspin_gripper_distal_service" pkg="pyspin_wrapper" type="pyspin_gripper_distal_service.py" respawn="false"/>
      <node pkg="rostopic" type="rostopic" name="overhead_camera_info" args="pub -f $(find rpi_arm_composites_manufacturing_testbed)/config/overhead_camera_sim_camera_info.yaml -l /overhead_camera/camera_info sensor_msgs/CameraInfo"/>
	  <node pkg="rostopic" type="rostopic" name="gripper_camera_1_camera_info" args="pub -f $(find rpi_arm_composites_manufacturing_testbed)/config/gripper_camera_1_camera_info.yaml -l /gripper_camera_1/camera_info sensor_msgs/CameraInfo"/>
	  <node pkg="rostopic" type="rostopic" name="gripper_camera_2_camera_info" args="pub -f $(find rpi_arm_composites_manufacturing_testbed)/config/gripper_camera_2_camera_info.yaml -l /gripper_camera_2/camera_info sensor_msgs/CameraInfo"/>
  </group>
  <arg name="disable_vision_server" default="false"/>
  <node name="ptgrey_vision_server" pkg="Vision_MoveIt_wason" type="ptgrey_vision_server" unless="$(arg disable_vision_server)"/>
  
  <arg name="disable_process_controller_server" default="false"/>
  <node name="process_controller_server" pkg="rpi_arm_composites_manufacturing_process" type="process_controller_server" unless="$(arg disable_process_controller_server)">
    <param name="disable_ft" value="$(arg sim)"/>    
  </node>
 <arg name="disable_gui" default="false"/>
 <node name="rqt_gui" pkg="rqt_gui" type="rqt_gui" unless="$(arg disable_gui)"/>
  <!-- TODO: launch GUI -->

  <node name="floating_transform_publisher" pkg="floating_transform_publisher" type="floating_transform_publisher"/>

</launch>
